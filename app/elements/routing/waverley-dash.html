<dom-module id="waverley-dash">
  <template>
    <style>

      neon-animated-pages {
        overflow-x: hidden;
        width: 100%;
        display: block;
        height: 1000px;
      }

      neon-animatable {
        padding: 32px;
      }

      neon-animatable > * {
        width: 100%;
      }



    </style>
    <style include="shared-styles"></style>
    <style include="iron-flex iron-flex-alignment"></style>

    <carbon-route route="{{route}}" pattern="/:tabName" data="{{data}}"></carbon-route>

    <paper-drawer-panel force-narrow="true">
      <paper-header-panel drawer>
        <paper-toolbar class="medium-tall">
          <div class="app-name">
            Menu
          </div>
        </paper-toolbar>
        <!-- <google-signin
          client-id="413722094262-4149pnqs89rldp7k15ht8q7fta7dr8ec.apps.googleusercontent.com"
          scopes="https://www.googleapis.com/auth/analytics">
        </google-signin> -->
      </paper-header-panel>
      <paper-scroll-header-panel main>
        <div class="paper-header">
          <paper-toolbar>
            <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
            <div class="app-name">
              <span class="waverley">Waverley</span><span class="dash">Dash</span>
            </div>
            <span class="flex"></span>
            <paper-icon-button icon="more-vert" on-tap="signOut"></paper-icon-button>
          </paper-toolbar>
          <paper-tabs selected='{{data.tabName}}' attr-for-selected="name">
            <paper-tab name='overview'>OVERVIEW</paper-tab>
            <paper-tab name='blog'>BLOG</paper-tab>
            <paper-tab name='settings'>SETTINGS</paper-tab>
          </paper-tabs>
        </div>

        <div>
          <neon-animated-pages id='animatedPages'
                               selected='{{selectedPage}}'
                               entry-animation='{{entryAnimation}}'
                               exit-animation='{{exitAnimation}}'
                               attr-for-selected="name">

            <neon-animatable class="vertical layout center" name='overview'>
              <overview-page views="56" comments="28"></overview-page>
            </neon-animatable>

            <neon-animatable class="vertical layout center" name='blog'>
              <new-post-editor on-add-post="addPost"></new-post-editor>

              <post-list posts="{{posts}}"
                         filter-by="{{route}}"
                         on-delete-post="deletePost">
              </post-list>
            </neon-animatable>

            <neon-animatable class="vertical layout center" name='settings'>
              <settings-page
                user="[[user]]"
              ></settings-page>
            </neon-animatable>

          </neon-animated-pages>
        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>



  </template>
  <script>
    window.addEventListener('WebComponentsReady', function() {
      Polymer({
        is: 'waverley-dash',
        properties: {
          route: {
            type: Object,
            notify: true
          },
          posts: {
            type: Array
          }
        },
        observers: [
          'pageChanged(data.tabName)'
        ],
        pageChanged: function() {
          // We assign to selectedPage here rather than just binding
          // the selected property of neon-animated-pages to selectedPage
          // so that we can first figure out which animation to use in the
          // transition.
          var transitioningFrom = this.$.animatedPages.selected;
          var transitioningTo = this.data.tabName;
          var pagesInOrder = this.$.animatedPages.items.map(
            function(x) {return x.getAttribute('name')});
          if (pagesInOrder.indexOf(transitioningFrom) > pagesInOrder.indexOf(transitioningTo)) {
            this.entryAnimation = 'slide-from-right-animation';
            this.exitAnimation = 'slide-left-animation';
          } else {
            this.entryAnimation = 'slide-from-left-animation';
            this.exitAnimation = 'slide-right-animation';
          }

          this.selectedPage = this.data.tabName;

          window.scroll(0,0);
          // slide-from-left-animation
        },

        addPost: function(e) {
          this.push('posts', {
            title: e.detail.title,
            author: e.detail.author,
            html: e.detail.html,
            isComplete: false
          });
        },

        deletePost: function(e) {
          this.arrayDelete('posts', e.detail.post);
        },

        clearPosts: function() {
          for (var i = 0; i < this.posts.length; i++) {
            var post = this.posts[i];
            if (post.isComplete) {
              this.splice('posts', i--, 1);
            }
          }
        },

        signOut: function() {
          this.fire('sign-out');
        },

      });
    });
  </script>
</dom-module>
